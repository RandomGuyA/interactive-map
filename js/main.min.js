!function(a,b,c){"use strict";var d="app_name",e=678401;a.app_name=function(b,c){var f={required:!0},g=this,h=e;g.settings={};var i=a(b),b=b,j=i.data(d+"-opts");g.init=function(){g.settings=a.extend({},f,c,j),console.log("initialised plugin "+d+" -- "+h)},g.foo_public_method=function(){};a.fn.bind_event=function(a){},g.init()},a.fn.app_name=function(b){return this.each(function(){if(void 0==a(this).data(d)){var c=new a.app_name(this,b);a(this).data(d,c)}})}}(jQuery,document,window),function(a,b,c){"use strict";var d="interactive_map_builder",e=298858;a.interactive_map_builder=function(b,c){var f,g,h,i={dropdown:!0,title:"Percentage of welsh speakers per county in Wales"},j=this,k=e,l=0,m=4,n=[],o=[],p=[],q=[],r=[];j.settings={};var s=a(b),b=b,t=s.data(d+"-opts");j.init=function(){j.settings=a.extend({},i,c,t),console.log("initialised plugin "+d+" -- "+k),s.append(a("<div>").attr("id","interface"),a("<div>").attr("id","map")),g=a("#map"),P("data/xml/welsh_counties.svg"),O("data/csv/year_data.csv"),O("data/csv/county.csv"),O("data/csv/county_to_year.csv")},j.foo_public_method=function(){};var u=function(){console.log("here"),D(),B(),v(q[0]),x(f),G(),R()},v=function(a){f=a},w=function(a){for(var b,c=0;c<q.length;c++)a==q[c].id&&(b=q[c]);return b},x=function(b){console.log("render map: "+b.year),y(),g.find("#layer"+b.layer_id).show(),a("path").click_county();var c=b.locations;a(".path-label").hide();for(var d=0;d<c.length;d++)H(c[d])},y=function(){g.find("#layer1").hide(),g.find("#layer2").hide()},z=function(){j.settings.dropdown&&(g.append(A()),a("#dropdown-"+k).dropdown_event_handler())},A=function(){return a("<select>").attr("id","dropdown-"+k).addClass("dropdown").append(a.map(q,function(b,c){return a("<option>").attr("value",b.id).text(b.year)}))},B=function(){z(),C()},C=function(){g.prepend(a("<div>").attr("id","label-wrapper").append(a("<ul>").attr("id","path-labels")));for(var b=0;b<o.length;b++)I(o[b])},D=function(){n=r[0],o=r[1],p=r[2];for(var a=0;a<n.length;a++){for(var b=T(n[a]),c=[],d=0;d<p.length;d++){var e=p[d];b.id==e[3]&&c.push(U(e))}b.locations=c,q.push(b)}},E=function(a){for(var b,c=0;c<o.length;c++){var d=o[c];if(a==d[0]){b=d;break}}return b},F=function(a){var b=a.split("-");return parseInt(b[b.length-1])},G=function(){h=a("#interface"),a("#interface").empty();var b=f.locations;a("#interface").append(a("<div>").addClass("interface-wrapper").append(a("<div>").addClass("interface-header").append(a("<h4>").text(f.year)),a("<ul>").append(a.map(b,function(b,c){return a("<li>").addClass("side-label").attr("id","side-label-"+b.id).text(b.welsh).append(a("<div>").addClass("left square").append(a("<div>").addClass("circle").text(b.id)),a("<div>").addClass("right square").append(a("<div>").addClass("circle").text(Math.round(b.value))))})))),a(".side-label").click_county_label()},H=function(b){var c=b.path_id,d=parseInt(b.value)/2*.01+.5,e=a.Color(135,0,0,d);a("#path"+c).css({fill:e}),J(b)},I=function(b){a("#path-labels").append(a("<li>").addClass("path-label").attr({id:"label"+b[0],title:b[2]}).text(b[3]))},J=function(a){var b=g.find("#label"+a.id);b.length>0&&b.css(K(a))},K=function(b){var c=a("#path"+b.path_id),d=-20,e=document.querySelector("#label"+b.id).getBoundingClientRect(),f=document.querySelector("#"+c.attr("id")).getBoundingClientRect(),g=c.position(),h=f.width,i=f.height,j=b.top/100*i,k=b.left/100*h,l=j+g.top-e.height/2+d,m=k+g.left-e.width/2;return{top:l,left:m}},L=function(a){for(var b,c=f.locations,d=0;d<c.length;d++)a==c[d].id&&(b=c[d]);return b},M=function(a){for(var b,c=f.locations,d=0;d<c.length;d++)a=="path"+c[d].path_id&&(b=c[d].id);return b},N=function(a){for(var b=a.split(/\r\n|\n/),c=b[0].split(","),d=[],e=1;e<b.length;e++){var f=b[e].split(",");if(f.length==c.length){for(var g=[],h=0;h<c.length;h++)g.push(f[h]);d.push(g)}}return l++,d},O=function(b){a.ajax(b).done(function(a){r.push(N(a)),console.log("content loaded")}).fail(function(a){alert("Error: "+a.responseText)})},P=function(b){a.ajax(b).done(function(b){g.html(a(b).find("svg")),console.log("content loaded"),l++}).fail(function(a){alert("Error: "+a.responseText)})},Q=setInterval(function(){l>=m&&(console.log("all loaded"),u(),S())},100),R=function(){for(var a=f.locations,b=0;b<a.length;b++)J(a[b])},S=function(){clearInterval(Q)};a.fn.dropdown_event_handler=function(b){a(this).on("change",function(){var b=parseInt(a(this).find(":selected").attr("value"));v(w(b)),x(f),R(),G()})},a(window).on("resize",function(){R()}),a.fn.click_county=function(){a(this).on("mouseover",function(){var b=a(this).attr("id"),c=M(b);a(".side-label").removeClass("active"),a("#side-label-"+c).addClass("active")}),a(this).on("mouseout",function(){var b=a(this).attr("id");M(b);a(".side-label").removeClass("active")})},a.fn.click_county_label=function(){a(this).on("mouseover",function(){a("path").removeClass("active");var b=a(this),c=F(b.attr("id")),d=L(c);a("#path"+d.path_id).addClass("active")}),a(this).on("mouseout",function(){a("path").removeClass("active")})};var T=function(a){return{id:a[0],year:a[1],layer_id:a[2]}},U=function(a){var b=E(a[2]);return{id:b[0],path_id:b[1],english:b[2],welsh:b[3],value:a[1],top:parseInt(b[4]),left:parseInt(b[5])}};j.init()},a.fn.interactive_map_builder=function(b){return this.each(function(){if(void 0==a(this).data(d)){var c=new a.interactive_map_builder(this,b);a(this).data(d,c)}})}}(jQuery,document,window),function(a,b,c){"use strict";function d(b,c){console.log(h+" activated"),this.$el=a(b),this.$el.data(h,this),this.defaults={required:!0};var d=this.$el.data(h+"-opts");this.opts=a.extend(this.defaults,c,d),this.init()}var e,f,g,h="plugin name";d.prototype.init=function(){e=this,f=e.$el,g=e.defaults},a.fn.plugin_name=function(a){return this.each(function(){new d(this,a)})}}(jQuery,document,window);