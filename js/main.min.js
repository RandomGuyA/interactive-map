!function(a,b,c){"use strict";var d="app_name",e=678401;a.app_name=function(b,c){var f={required:!0},g=this,h=e;g.settings={};var i=a(b),b=b,j=i.data(d+"-opts");g.init=function(){g.settings=a.extend({},f,c,j),console.log("initialised plugin "+d+" -- "+h)},g.foo_public_method=function(){};a.fn.bind_event=function(a){},g.init()},a.fn.app_name=function(b){return this.each(function(){if(void 0==a(this).data(d)){var c=new a.app_name(this,b);a(this).data(d,c)}})}}(jQuery,document,window),function(a,b,c){"use strict";var d="interactive_map_builder",e=298858;a.interactive_map_builder=function(b,c){var f,g,h,i,j={dropdown:!0,title:"Percentage of welsh speakers per county in Wales",DIRECTORY:"",key_container:a("#interactive-map"),add_labels:!1,nav_type:"slider"},k=this,l=e,m=0,n=4,o=[],p=[],q=[],r=[],s=[];k.settings={};var t=a(b),b=b,u=t.data(d+"-opts");k.init=function(){k.settings=a.extend({},j,c,u),f=k.settings,console.log("initialised plugin "+d+" -- "+l),w(),X(f.DIRECTORY+"data/xml/welsh_counties.svg"),W(f.DIRECTORY+"data/csv/year_data.csv"),W(f.DIRECTORY+"data/csv/county.csv"),W(f.DIRECTORY+"data/csv/county_to_year.csv")},k.update_map=function(a){x(R(r,{year:y(a)})),A(g),H(g),M()};var v=function(){h.append(a("<div>").attr("id","label-wrapper").append(a("<ul>").attr("id","path-labels"))),J(),C(),x(r[0]),A(g),H(g),M(),Z(g)},w=function(){t.append(a("<div>").attr("id","interface"),a("<div>").attr("id","map")),h=a("#map")},x=function(a){g=a},y=function(a){return 10*Math.floor(a/10)+1},z=function(a){for(var b,c=0;c<r.length;c++)a==r[c].id&&(b=r[c]);return b},A=function(b){console.log("render map: "+b.year),B(),h.find("#layer"+b.layer_id).show(),a("path").click_county(),a(".path-label").hide(),Q(N,b.locations)},B=function(){h.find("#layer1").hide(),h.find("#layer2").hide()},C=function(){switch(f.nav_type){case"dropdown":E();break;case"slider":D()}},D=function(){h.prepend(G()),a("#slider-"+l).slider_event_handler()},E=function(){k.settings.dropdown&&(h.append(F()),a("#dropdown-"+l).dropdown_event_handler())},F=function(){return a("<select>").attr("id","dropdown-"+l).addClass("dropdown").append(a.map(r,function(b,c){return a("<option>").attr("value",b.id).text(b.year)}))},G=function(){return a("<div>").addClass("map-navigation").append(a("<div>").addClass("slider-wrapper").append(a("<input>").attr({id:"slider-"+l,type:"range",min:1951,max:2011,step:10}).addClass("inner-slider slider"),a("<ul>").addClass("inner-slider year-list").append(a("<li>").text("1951"),a("<li>").text("1961"),a("<li>").text("1971"),a("<li>").text("1981"),a("<li>").text("1991"),a("<li>").text("2001"),a("<li>").text("2011"))))},H=function(b){a("#path-labels").empty(),Q(I,b.locations)},I=function(b){k.settings.add_labels&&a("#path-labels").append(a("<li>").addClass("path-label circle").attr({id:"label"+b.id,title:b.welsh}).text(Math.round(b.value)+"%").css(P(b)))},J=function(){o=s[0],p=s[1],q=s[2];for(var a=0;a<o.length;a++){for(var b=_(o[a]),c=[],d=0;d<q.length;d++){var e=q[d];b.id==e[3]&&c.push(aa(e))}b.locations=c,r.push(b)}},K=function(a){for(var b,c=0;c<p.length;c++){var d=p[c];if(a==d[0]){b=d;break}}return b},L=function(a){var b=a.split("-");return parseInt(b[b.length-1])},M=function(){i=a("#interface"),a("#interface").empty();var b=g.locations;a("#interface").append(a("<div>").addClass("interface-wrapper").append(a("<div>").addClass("interface-header").append(a("<h4>").text(g.year+" Census")),a("<ul>").append(a("<li>").addClass("top-label active").text("Sir").append(a("<div>").addClass("left square").append(a("<div>").addClass("circle").text("%")),a("<div>").addClass("right square").append(a("<div>").addClass("circle").text())),a.map(b,function(b,c){return a("<li>").addClass("side-label").attr("id","side-label-"+b.id).text(b.welsh).append(a("<div>").addClass("left square").append(a("<div>").addClass("circle").text(Math.round(b.value))),a("<div>").addClass("right square").append(a("<div>").addClass("circle").text()))})))),k.settings.key_container.prepend(i),a(".side-label").click_county_label()},N=function(b){var c=b.path_id,d=parseInt(b.value)/2*.01+.5,e=a.Color(135,0,0,d);a("#path"+c).css({fill:e}),k.settings.add_labels&&O(b)},O=function(a){var b=h.find("#label"+a.id);b.length>0&&b.css(P(a))},P=function(b){var c=a("#path"+b.path_id),d=-20,e=15,f=document.querySelector("#"+c.attr("id")).getBoundingClientRect(),g=c.position(),h=f.width,i=f.height,j=b.top/100*i,k=b.left/100*h,l=j+g.top-e+d,m=k+g.left-e;return 1==b.id,{top:l,left:m}},Q=function(a,b){for(var c=0;c<b.length;c++)a(b[c])},R=function(a,b){for(var c=0;c<a.length;c++){var d=S(b,a[c]);if(void 0!=d)return d}},S=function(a,b){var c=Object.keys(a)[0];return a[c]==b[c]?b:null},T=function(a){return R(g.locations,{id:a})},U=function(a){return a=parseInt(a.replace("path","")),R(g.locations,{path_id:a})},V=function(a){for(var b=a.split(/\r\n|\n/),c=b[0].split(","),d=[],e=1;e<b.length;e++){var f=b[e].split(",");if(f.length==c.length){for(var g=[],h=0;h<c.length;h++)g.push(f[h]);d.push(g)}}return m++,d},W=function(b){a.ajax(b).done(function(a){s.push(V(a))}).fail(function(a){alert("Error: "+a.responseText)})},X=function(b){a.ajax(b).done(function(b){h.html(a(b).find("svg")),m++}).fail(function(a){alert("Error: "+a.responseText)})},Y=setInterval(function(){m>=n&&(v(),$())},100),Z=function(a){Q(O,a.locations)},$=function(){clearInterval(Y)};a.fn.dropdown_event_handler=function(b){a(this).on("change",function(){var b=parseInt(a(this).find(":selected").attr("value"));x(z(b)),A(g),H(g),M()})},a.fn.slider_event_handler=function(){var b=a(this);b.on("change",function(){k.update_map(parseInt(a(this).val()))})},a(window).on("resize",function(){H(g)}),a.fn.click_county=function(){a(this).on("mouseover",function(){var b=a(this).attr("id"),c=U(b);a(".side-label").removeClass("active"),void 0!=c&&a("#side-label-"+c.id).addClass("active")}),a(this).on("mouseout",function(){a(".side-label").removeClass("active")})},a.fn.click_county_label=function(){a(this).on("mouseover",function(){a("path").removeClass("active");var b=a(this),c=L(b.attr("id")),d=T(c);a("#path"+d.path_id).addClass("active")}),a(this).on("mouseout",function(){a("path").removeClass("active")})};var _=function(a){return{id:a[0],year:a[1],layer_id:a[2]}},aa=function(a){var b=K(a[2]);return{id:b[0],path_id:b[1],english:b[2],welsh:b[3],value:a[1],top:parseInt(b[4]),left:parseInt(b[5])}};k.init()},a.fn.interactive_map_builder=function(b){return this.each(function(){if(void 0==a(this).data(d)){var c=new a.interactive_map_builder(this,b);a(this).data(d,c)}})}}(jQuery,document,window),function(a,b,c){"use strict";function d(b,c){console.log(h+" activated"),this.$el=a(b),this.$el.data(h,this),this.defaults={required:!0};var d=this.$el.data(h+"-opts");this.opts=a.extend(this.defaults,c,d),this.init()}var e,f,g,h="plugin name";d.prototype.init=function(){e=this,f=e.$el,g=e.defaults},a.fn.plugin_name=function(a){return this.each(function(){new d(this,a)})}}(jQuery,document,window);